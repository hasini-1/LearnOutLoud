"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.predictionLayer = predictionLayer;
const tf = require("@tensorflow/tfjs-core");
const boxPredictionLayer_1 = require("./boxPredictionLayer");
const pointwiseConvLayer_1 = require("./pointwiseConvLayer");
function predictionLayer(x, conv11, params) {
    return tf.tidy(() => {
        const conv0 = (0, pointwiseConvLayer_1.pointwiseConvLayer)(x, params.conv_0, [1, 1]);
        const conv1 = (0, pointwiseConvLayer_1.pointwiseConvLayer)(conv0, params.conv_1, [2, 2]);
        const conv2 = (0, pointwiseConvLayer_1.pointwiseConvLayer)(conv1, params.conv_2, [1, 1]);
        const conv3 = (0, pointwiseConvLayer_1.pointwiseConvLayer)(conv2, params.conv_3, [2, 2]);
        const conv4 = (0, pointwiseConvLayer_1.pointwiseConvLayer)(conv3, params.conv_4, [1, 1]);
        const conv5 = (0, pointwiseConvLayer_1.pointwiseConvLayer)(conv4, params.conv_5, [2, 2]);
        const conv6 = (0, pointwiseConvLayer_1.pointwiseConvLayer)(conv5, params.conv_6, [1, 1]);
        const conv7 = (0, pointwiseConvLayer_1.pointwiseConvLayer)(conv6, params.conv_7, [2, 2]);
        const boxPrediction0 = (0, boxPredictionLayer_1.boxPredictionLayer)(conv11, params.box_predictor_0);
        const boxPrediction1 = (0, boxPredictionLayer_1.boxPredictionLayer)(x, params.box_predictor_1);
        const boxPrediction2 = (0, boxPredictionLayer_1.boxPredictionLayer)(conv1, params.box_predictor_2);
        const boxPrediction3 = (0, boxPredictionLayer_1.boxPredictionLayer)(conv3, params.box_predictor_3);
        const boxPrediction4 = (0, boxPredictionLayer_1.boxPredictionLayer)(conv5, params.box_predictor_4);
        const boxPrediction5 = (0, boxPredictionLayer_1.boxPredictionLayer)(conv7, params.box_predictor_5);
        const boxPredictions = tf.concat([
            boxPrediction0.boxPredictionEncoding,
            boxPrediction1.boxPredictionEncoding,
            boxPrediction2.boxPredictionEncoding,
            boxPrediction3.boxPredictionEncoding,
            boxPrediction4.boxPredictionEncoding,
            boxPrediction5.boxPredictionEncoding,
        ], 1);
        const classPredictions = tf.concat([
            boxPrediction0.classPrediction,
            boxPrediction1.classPrediction,
            boxPrediction2.classPrediction,
            boxPrediction3.classPrediction,
            boxPrediction4.classPrediction,
            boxPrediction5.classPrediction,
        ], 1);
        return {
            boxPredictions,
            classPredictions,
        };
    });
}
