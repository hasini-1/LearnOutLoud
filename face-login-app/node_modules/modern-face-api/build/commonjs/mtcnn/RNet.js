"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RNet = RNet;
const tf = require("@tensorflow/tfjs-core");
const fullyConnectedLayer_1 = require("../common/fullyConnectedLayer");
const prelu_1 = require("./prelu");
const sharedLayers_1 = require("./sharedLayers");
function RNet(x, params) {
    return tf.tidy(() => {
        const convOut = (0, sharedLayers_1.sharedLayer)(x, params);
        const vectorized = tf.reshape(convOut, [
            convOut.shape[0],
            params.fc1.weights.shape[0],
        ]);
        const fc1 = (0, fullyConnectedLayer_1.fullyConnectedLayer)(vectorized, params.fc1);
        const prelu4 = (0, prelu_1.prelu)(fc1, params.prelu4_alpha);
        const fc2_1 = (0, fullyConnectedLayer_1.fullyConnectedLayer)(prelu4, params.fc2_1);
        const max = tf.expandDims(tf.max(fc2_1, 1), 1);
        const prob = tf.softmax(tf.sub(fc2_1, max), 1);
        const regions = (0, fullyConnectedLayer_1.fullyConnectedLayer)(prelu4, params.fc2_2);
        const scores = tf.unstack(prob, 1)[1];
        return { scores, regions };
    });
}
